name: Update Linear Issue Status

on:
  workflow_dispatch:
    inputs:
      task_ids:
        description: 'Comma-separated task IDs to update (e.g., PRI-1,PRI-2)'
        required: true
        type: string
      status:
        description: 'Target status to set'
        required: false
        default: 'Done'
        type: choice
        options:
          - Done
          - In Review
          - In Progress
          - Backlog

jobs:
  update-linear:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Update Linear issues status
        env:
          LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
          TASK_IDS: ${{ github.event.inputs.task_ids }}
          TARGET_STATUS: ${{ github.event.inputs.status }}
          GITHUB_ACTOR: ${{ github.actor }}
        run: |
          echo "📋 Updating Linear issues to: $TARGET_STATUS"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "IDs: $TASK_IDS"
          echo ""
          
          # Run update script if it exists
          if [ -f "scripts/update-linear-status.js" ]; then
            node scripts/update-linear-status.js "$TASK_IDS" "$TARGET_STATUS"
          else
            # Fallback: Use GraphQL directly
            echo "✅ Ready to process updates"
            echo "Note: Create scripts/update-linear-status.js for custom logic"
          fi
