name: Create Linear Sub-Issues (Generic)

on:
  workflow_dispatch:
    inputs:
      parent_id:
        description: 'Parent Linear Issue ID (e.g., PRI-1412, PRI-2000, etc.)'
        required: true
        type: string
      tasks_file:
        description: 'Path to tasks.md file (relative to repo root)'
        required: false
        default: 'specs/014-thursday-stopwatch-ui/tasks.md'
        type: string

jobs:
  create-sub-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Create Linear Sub-Issues
        env:
          LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
          PARENT_ID: ${{ inputs.parent_id }}
          TASKS_FILE: ${{ inputs.tasks_file }}
        run: |
          echo "🚀 Creating Linear sub-issues"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "📌 Parent Issue ID: $PARENT_ID"
          echo "📋 Tasks File: $TASKS_FILE"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo ""
          
          if [ ! -f "create-sub-issues-pri1412.mjs" ]; then
            echo "❌ Error: create-sub-issues-pri1412.mjs not found"
            exit 1
          fi
          
          if [ ! -f "$TASKS_FILE" ]; then
            echo "❌ Error: Tasks file not found at $TASKS_FILE"
            exit 1
          fi
          
          if [ -z "$LINEAR_API_KEY" ]; then
            echo "❌ Error: LINEAR_API_KEY not set in GitHub secrets"
            exit 1
          fi
          
          echo "✅ All prerequisites met"
          echo ""
          echo "Running sub-issue creation..."
          echo "════════════════════════════════════════════════════════════════"
          echo ""
          
          node create-sub-issues-pri1412.mjs
          
          echo ""
          echo "════════════════════════════════════════════════════════════════"
          echo "✅ Sub-issue creation completed!"
          echo ""
          echo "📋 Next steps:"
          echo "   1. Go to Linear: https://linear.app/coding-mystery/issue/$PARENT_ID"
          echo "   2. Refresh to see the new sub-issues"
          echo "   3. Begin implementation following the dependency order"
