# Data Model — Chapter 6 Day 2 Scaffold

## Entities

### Expense
- **Identifier**: `id` (string UUID from Chapter 5 API)
- **Fields**:
  - `merchant` (string, required) — Render primary label; fallback to `"Unknown merchant"` if missing.
  - `category` (enum string, optional) — Maps to existing badge palette; placeholder `"Uncategorized"` when undefined.
  - `purchaseDate` (ISO 8601 string, required) — Used for default sort (descending) and formatted via Day 1 typography rules.
  - `status` (enum string: `PENDING | APPROVED | FLAGGED | REJECTED`, required) — Drives badge semantics and row aria-labels.
  - `amount` (object, required) — `{ currency: string (ISO 4217), value: number (cents) }`, rendered via shared currency formatter.
  - `memo` (string, optional) — Compact secondary line; trimmed to 120 chars for virtualization stability.
  - `attachments` (array<string>, optional) — Not displayed Day 2 but preserved for later phases.
- **Validation Rules**:
  - Reject rows without `id` or `purchaseDate` (log + skip to keep UI stable).
  - Coerce invalid `category` values to `"Uncategorized"` and continue.
  - Negative `amount.value` flagged in telemetry but still displayed (refund use case).

### ExpenseListViewState
- **Identifier**: Derived from query lifecycle (`loading | empty | error | success`).
- **Fields**:
  - `status` (enum) — Determines which component renders.
  - `fetchedAt` (timestamp) — Stored per session to satisfy retry metadata requirement.
  - `error` ({ message: string, code?: string }) — Present only for `error` state; logged to telemetry.
  - `retryCount` (number) — Incremented whenever the retry button is clicked; persisted in TanStack Query meta.
  - `items` (array<Expense>) — Populated when `status === 'success'`.
- **Validation Rules**:
  - `status === 'empty'` requires `items.length === 0`.
  - `status === 'success'` requires `items.length > 0` and sorted descending by `purchaseDate`.

### ReviewPacketArtifact
- **Identifier**: `artifactId` composed of `{commitSha}-{artifactType}`.
- **Fields**:
  - `coverageReportPath` (string) — Points to `review-artifacts/ui-coverage/index.html` generated by Vitest.
  - `screenshots` (array<{ state: ExpenseListViewState['status']; path: string }>) — Four required images stored under `review-artifacts/ui-states/`.
  - `ciRunId` (string) — Links artifact to CI pipeline execution.
  - `generatedAt` (timestamp) — When the artifact bundle completed.
- **Validation Rules**:
  - Must include entries for each of the four UI states; CI fails if any screenshot missing.
  - Coverage report must show ≥55% statements; otherwise review packet flagged.

## Relationships
- `ExpenseListViewState.items[]` ⟶ `Expense` (one-to-many). Rows originate from Chapter 5 API via proxy.
- `ReviewPacketArtifact.screenshots[]` references `ExpenseListViewState.status` to prove compliance with FR-010.
- Proxy route persists `ExpenseListViewState` metadata to local TanStack Query cache; review packet reads aggregated coverage/screenshot outputs but not direct state objects.

## State Transitions
```
loading --(fetch success items>0)--> success
loading --(fetch success items=0)--> empty
loading --(fetch error|timeout)--> error
error --(retry click)--> loading
success --(manual refresh)--> loading
empty --(retry click)--> loading
```
- Cache reuse: navigating away and back stays in `success`/`empty` until cache expires (`staleTime` 2 minutes) or manual retry.
- Drawer interactions do not alter `ExpenseListViewState`; they operate on a separate UI machine but rely on `items` for contextual copy.
