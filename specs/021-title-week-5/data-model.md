# Data Model: Week 5 Day-0: API Scaffolding and Spec-First Setup

**Feature**: Week 5 Day-0: API Scaffolding and Spec-First Setup  
**Date**: 2025-01-27

---

## Overview

This feature establishes the Day-0 foundation for API development. The data model focuses on the infrastructure entities required for scaffolding, not business domain entities (which will be added in future features).

---

## Entities

### 1. API Project Structure

**Entity**: `APIProject`  
**Purpose**: Represents the self-contained Node.js project within `/api` directory

**Fields**:
- `directory`: `/api` (string, required)
- `packageJson`: Package configuration (object, required)
- `tsconfig`: TypeScript configuration (object, required)
- `vitestConfig`: Test configuration (object, required)
- `envExample`: Environment variables template (object, required)

**Validation Rules**:
- Must exist at repository root
- Must contain `package.json`, `tsconfig.json`, `vitest.config.ts`
- Must contain `src/`, `tests/`, `spec/` directories
- Must include `.env.example` file

**Relationships**:
- Contains multiple `APIEndpoint` entities
- Contains one `APISpecification` entity
- Contains multiple `TestSuite` entities

---

### 2. API Specification

**Entity**: `APISpecification`  
**Purpose**: Contract document defining API endpoints, request/response schemas, and validation rules

**Fields**:
- `format`: "OpenAPI" (string, required)
- `version`: "3.1" (string, required)
- `filePath`: "/api/spec/openapi.yaml" (string, required)
- `endpoints`: Array of endpoint definitions (array, required, minimum 1)

**Validation Rules**:
- Must exist in `/api/spec/` directory
- Must be committed to version control before implementation
- Must contain at least one example endpoint (GET /health)
- Must support contract validation and documentation generation

**Relationships**:
- Defines multiple `APIEndpoint` entities
- Referenced by `CIWorkflow` for artifact generation

**State Transitions**:
- `draft` → `committed` (when added to version control)
- `committed` → `validated` (when CI validates against implementation)

---

### 3. API Endpoint

**Entity**: `APIEndpoint`  
**Purpose**: Individual REST API endpoint definition

**Fields**:
- `method`: HTTP method (GET, POST, PUT, DELETE, etc.) (string, required)
- `path`: URL path (e.g., "/health") (string, required)
- `requestSchema`: Request validation schema (object, optional)
- `responseSchema`: Response validation schema (object, required)
- `statusCodes`: Valid HTTP status codes (array, required)

**Validation Rules**:
- Must be defined in OpenAPI specification before implementation
- Must have corresponding contract test
- Must have corresponding route handler in `src/routes/`

**Relationships**:
- Defined by `APISpecification`
- Implemented by `RouteHandler`
- Tested by `ContractTest`

**Example (GET /health)**:
- `method`: "GET"
- `path`: "/health"
- `responseSchema`: `{ status: "ok", timestamp: string }`
- `statusCodes`: [200]

---

### 4. Review Packet Artifact

**Entity**: `ReviewPacketArtifact`  
**Purpose**: CI-generated artifact containing specifications, coverage, and test reports

**Fields**:
- `name`: "review-packet-api" (string, required)
- `indexHtml`: Navigation structure HTML file (file, required)
- `openApiSpec`: API specification file (file, required)
- `coverageReports`: Test coverage reports (array, required)
- `testReports`: Test execution reports (array, required)

**Validation Rules**:
- Must include `index.html` with navigation structure matching Week 4 patterns
- Must include OpenAPI specification
- Must include coverage reports (lcov.info + HTML)
- Must include test execution reports
- All files must exist before artifact upload (fail-fast validation)

**Relationships**:
- Generated by `CIWorkflow`
- Contains `APISpecification` entity
- Contains multiple `CoverageReport` entities

**State Transitions**:
- `generating` → `verified` (when all files validated)
- `verified` → `uploaded` (when uploaded to GitHub Actions)

---

### 5. CI Workflow

**Entity**: `CIWorkflow`  
**Purpose**: Automated GitHub Actions workflow for API project validation

**Fields**:
- `name`: "api-checks.yml" (string, required)
- `location`: ".github/workflows/api-checks.yml" (string, required)
- `steps`: Array of workflow steps (array, required)
- `artifactName`: "review-packet-api" (string, required)

**Validation Rules**:
- Must execute linting checks
- Must execute tests with coverage reporting
- Must generate review-packet-api artifact
- Must follow Week 4 CI workflow patterns
- Must fail if any step fails

**Relationships**:
- Validates `APIProject` structure
- Generates `ReviewPacketArtifact`
- Executes `TestSuite` entities

**Workflow Steps** (in order):
1. Lint check
2. Test execution with coverage
3. Copy coverage to review-artifacts
4. Verify all files exist
5. Generate index.html
6. Upload artifact

---

### 6. Test Suite

**Entity**: `TestSuite`  
**Purpose**: Collection of tests for the API project

**Fields**:
- `type`: "contract" | "integration" | "unit" (string, required)
- `location`: Directory path (string, required)
- `framework`: "vitest" (string, required)
- `coverageEnabled`: true (boolean, required)

**Validation Rules**:
- Must be executable via `npm test`
- Must generate coverage reports (no minimum threshold for Day-0)
- Contract tests must fail initially (no implementation)

**Relationships**:
- Part of `APIProject`
- Generates `CoverageReport` entities

---

## Validation Summary

All entities align with functional requirements:
- **FR-001 to FR-004**: Repository structure → `APIProject` entity
- **FR-005 to FR-007**: Development environment → Covered by `APIProject` configuration
- **FR-008 to FR-010**: API server foundation → Covered by `APIEndpoint` and server infrastructure
- **FR-011 to FR-013**: Testing infrastructure → `TestSuite` entity
- **FR-014 to FR-017**: Spec-first workflow → `APISpecification` and `APIEndpoint` entities
- **FR-018 to FR-023**: CI/CD integration → `CIWorkflow` and `ReviewPacketArtifact` entities

---

## Notes

- No business domain entities required for Day-0 setup
- All entities are infrastructure-focused
- Future features will add business entities (e.g., User, Resource, etc.)
- Data model supports spec-first workflow: specification → contract tests → implementation

