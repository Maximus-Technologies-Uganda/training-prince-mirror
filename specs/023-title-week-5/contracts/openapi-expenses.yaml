openapi: 3.0.0
info:
  title: Expense Management API
  version: 1.0.0
  description: MVP endpoints for expense management - POST and GET with aggregation

servers:
  - url: http://localhost:3000
    description: Development server

paths:
  /expenses:
    post:
      summary: Create a new expense
      description: |
        Submit a new expense record with amount, category, and date.
        Server assigns a unique ID and returns the created record.
      operationId: createExpense
      requestBody:
        required: true
        description: Expense details
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateExpenseRequest'
            examples:
              valid:
                summary: Valid expense submission
                value:
                  amount: 25.50
                  category: food
                  date: "2025-11-05"
              invalid_negative:
                summary: Invalid - negative amount
                value:
                  amount: -10
                  category: food
                  date: "2025-11-05"
              invalid_zero:
                summary: Invalid - zero amount
                value:
                  amount: 0
                  category: food
                  date: "2025-11-05"
              invalid_date_format:
                summary: Invalid - wrong date format
                value:
                  amount: 25.50
                  category: food
                  date: "11/05/2025"
      responses:
        '201':
          description: Expense created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Expense'
              example:
                id: 550e8400-e29b-41d4-a716-446655440000
                amount: 25.50
                category: food
                date: "2025-11-05"
        '400':
          description: Validation error - invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                negative_amount:
                  summary: Amount must be positive
                  value:
                    errors:
                      - field: amount
                        message: "amount must be greater than 0"
                invalid_date:
                  summary: Invalid date format
                  value:
                    errors:
                      - field: date
                        message: "date must be in YYYY-MM-DD format (received: 11/05/2025)"
                missing_field:
                  summary: Missing required field
                  value:
                    errors:
                      - field: amount
                        message: "amount is required"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

  /expenses/summary:
    get:
      summary: Get aggregated expense summary
      description: |
        Retrieve aggregated expense data with optional filtering.
        Supports filtering by category, month, or both.
        Returns total amount, count, and applied filters.
      operationId: getExpenseSummary
      parameters:
        - name: category
          in: query
          required: false
          description: Filter by category name
          schema:
            type: string
          example: food
        - name: month
          in: query
          required: false
          description: Filter by month in YYYY-MM format
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
          example: "2025-11"
      responses:
        '200':
          description: Expense summary retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseSummary'
              examples:
                no_filters:
                  summary: All expenses aggregated
                  value:
                    total: 150.75
                    count: 5
                    filters: {}
                category_filter:
                  summary: Filtered by food category
                  value:
                    total: 45.50
                    count: 2
                    filters:
                      category: food
                month_filter:
                  summary: Filtered by November 2025
                  value:
                    total: 230.00
                    count: 8
                    filters:
                      month: "2025-11"
                both_filters:
                  summary: Filtered by food and November
                  value:
                    total: 12.99
                    count: 1
                    filters:
                      category: food
                      month: "2025-11"
                empty_result:
                  summary: No expenses match filters
                  value:
                    total: 0
                    count: 0
                    filters:
                      category: nonexistent
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

components:
  schemas:
    CreateExpenseRequest:
      type: object
      description: Request body for creating an expense
      required:
        - amount
        - category
        - date
      properties:
        amount:
          type: number
          description: Expense amount (must be positive)
          exclusiveMinimum: 0
          example: 25.50
        category:
          type: string
          description: Expense category
          minLength: 1
          example: food
        date:
          type: string
          format: date
          description: ISO 8601 date (YYYY-MM-DD)
          pattern: '^\d{4}-\d{2}-\d{2}$'
          example: "2025-11-05"

    Expense:
      type: object
      description: Expense record with server-assigned ID
      required:
        - id
        - amount
        - category
        - date
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier (auto-assigned)
          example: 550e8400-e29b-41d4-a716-446655440000
        amount:
          type: number
          description: Expense amount
          exclusiveMinimum: 0
          example: 25.50
        category:
          type: string
          description: Expense category
          example: food
        date:
          type: string
          format: date
          description: ISO 8601 date
          example: "2025-11-05"

    ExpenseSummary:
      type: object
      description: Aggregated expense data
      required:
        - total
        - count
        - filters
      properties:
        total:
          type: number
          description: Sum of amounts matching filter criteria
          minimum: 0
          example: 150.75
        count:
          type: integer
          description: Number of expenses matching filter criteria
          minimum: 0
          example: 5
        filters:
          type: object
          description: Applied filter criteria
          additionalProperties: false
          properties:
            category:
              type: string
              description: Category filter applied
              example: food
            month:
              type: string
              description: Month filter applied (YYYY-MM)
              pattern: '^\d{4}-\d{2}$'
              example: "2025-11"

    ValidationError:
      type: object
      description: Validation error response
      required:
        - errors
      properties:
        errors:
          type: array
          items:
            type: object
            required:
              - field
              - message
            properties:
              field:
                type: string
                description: Field that failed validation
                example: amount
              message:
                type: string
                description: Descriptive error message
                example: amount must be greater than 0

    ServerError:
      type: object
      description: Server error response
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
          example: Internal server error

