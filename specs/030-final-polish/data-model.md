# Phase 1 Design: Data Model & Entities

**Date**: 2025-11-12  
**Feature**: 030-final-polish  
**Status**: Phase 1 (Design & Contracts)

## Core Entities

### 1. CHANGELOG Entry (Documentation Entity)

**Purpose**: Tracks features and changes for a given week, displayed to reviewers and mentors.

**Schema**:
```yaml
ChangelogEntry:
  week: string                # "Week 5"
  section: enum              # "Added" | "Changed" | "Fixed" | "Removed" | "Deprecated" | "Security" | "Notes"
  items: Array<string>       # Feature description lines
  subItems: Array<string>    # Optional bullet points per item
  priority: "P0" | "P1" | "P2"  # Optional; used for sorting display
  timestamp: ISO8601         # When entry was added
  author: string             # Git commit author
  
ChangelogStructure:
  title: "Changelog"         # File header
  sections: Array<ChangelogEntry>  # One per week/release
  mostRecent: ChangelogEntry   # Week 5 section (at top)
```

**Key Fields**:
- **week**: Semantic identifier for grouping (e.g., "Week 5 - Final Polish")
- **section**: Standard Keep a Changelog category for consistency
- **items**: One-line summaries (max 80 chars per item)
- **subItems**: Optional detailed descriptions (3-5 lines max for readability)

**Validation Rules**:
- Each item MUST have a one-line summary
- Section headers MUST use exact markdown format: `## Week [N]` or `### [Category]`
- No duplicate entries within same week/section
- Entry must reference at least one corresponding GitHub issue or PR number

**State Transitions**:
- Draft (uncommitted) → Staged (in pull request) → Merged (in main branch CHANGELOG.md)

---

### 2. Review Packet Artifact (Composite Documentation Entity)

**Purpose**: Single entry point providing mentors with access to all four required project artifacts for final review.

**Schema**:
```yaml
ReviewPacketArtifact:
  indexHtml:
    title: "Week 5 Review Packet"
    description: "Complete project review documentation and coverage reports"
    generatedAt: ISO8601
    lastUpdated: ISO8601
    
  sections: Array<ReviewArtifactSection>
    - name: "Coverage Table"
      url: string                    # Relative path: ./coverage-**/lcov-report/index.html
      type: "coverage-index"
      description: "API test coverage for all modules (target ≥70%)"
      artifact: "review-artifacts/index.html (generated by generate-coverage-index.js)"
      coverage: {
        overall: percentage          # ≥70% threshold
        modules: Array<{
          name: string              # "hello", "stopwatch", etc.
          coverage: percentage
          path: string              # lcov-report/index.html
        }>
      }
      
    - name: "OpenAPI Documentation"
      url: string                    # Relative path: ./openapi.html
      type: "api-spec"
      description: "Interactive API specification (generated by Redoc)"
      artifact: "review-artifacts/openapi.html (generated by redoc-cli)"
      endpoints: Array<{
        method: "GET" | "POST" | "PUT" | "DELETE"
        path: string               # /expenses, /expenses/summary
        description: string
      }>
      
    - name: "Playwright Test Report"
      url: string                    # URL to GitHub Actions artifact or local path
      type: "test-report"
      description: "Automated smoke test results (e2e validation)"
      artifact: "GitHub Actions artifact from playwright-e2e-smoke.yml"
      testStatus: "passing" | "failing"
      suiteCount: integer
      
    - name: "CHANGELOG Summary"
      url: string                    # Link to CHANGELOG.md (repository main branch)
      type: "release-notes"
      description: "Week 5 feature summary and deliverables"
      artifact: "CHANGELOG.md in repository root"
      weekSummary: {
        features: Array<string>      # ["API Scaffolding", "POST /expenses", ...]
        coverage: string             # "Hardened to 70% threshold"
        mentor_focus: string         # "Rate limiting, API design, test quality"
      }
  
  metadata:
    branch: "main"
    isReadyForDemo: boolean
    lastValidated: ISO8601
    validationErrors: Array<string>
    
ReviewPacketValidation:
  allLinksAccessible: boolean        # Each artifact must exist and load
  coverageAboveThreshold: boolean    # ≥70%
  openApiValid: boolean              # Schema renders without errors
  playwrightReportExists: boolean    # If applicable
  changelogHasWeek5: boolean         # Week 5 section exists
```

**Key Fields**:
- **indexHtml**: Main entry point; must load in <2 seconds
- **sections**: Four artifacts with URLs and descriptions
- **metadata**: Validation state and readiness for demo

**Validation Rules**:
- All four artifact URLs MUST be accessible (no 404s)
- Coverage percentage MUST display as ≥70% or show warning
- OpenAPI HTML MUST render without console errors
- CHANGELOG.md MUST contain "Week 5" section header
- Links MUST be relative paths or absolute repository URLs (no localhost)

**State Transitions**:
- Generated (workflow runs) → Validated (all links checked) → Ready for Demo (mentors can access)

---

### 3. Demo Walkthrough Script (Operational Entity)

**Purpose**: Structured runbook for 10-minute mentor demo; ensures all deliverables are presented clearly.

**Schema**:
```yaml
DemoScript:
  title: "Week 5 Final Demo: 10-Minute Walkthrough"
  duration: "10 minutes (strict)"
  
  phases: Array<DemoPhase>
    - phase: integer              # 1-5
      name: string               # "Setup & Context", "API Coverage", etc.
      duration: "~2 minutes"
      objectives: Array<string>
      steps: Array<DemoStep>
      artifacts: Array<string>   # URLs/files to open
      speaker_notes: string
      fallbacks: Array<Fallback>
      
    DemoStep:
      order: integer
      action: string             # "Open review-packet index.html"
      expectedOutcome: string    # What user should see
      timing: "30 seconds" | "1 minute"
      isOptional: boolean        # Some steps skipped if time is short
      
    Fallback:
      condition: "If X unavailable"
      action: string            # "Show screenshot instead" | "Skip to next phase"
      
  mentorSignOff:
    approval_comment_template: string  # GitHub comment template
    required_fields: Array<string>      # ["Deliverables Reviewed", "Coverage OK", "No Blockers"]
    
  artifacts:
    review_packet_url: string
    openapi_path: string
    changelog_path: string
    playwright_report_url: string
```

**Key Fields**:
- **phases**: 5 sequential phases with specific objectives
- **duration**: Hard 10-minute limit with optional/fallback elements
- **mentorSignOff**: Template for GitHub comment approval

**Timing Constraints**:
- Phase 1: Setup (1 min)
- Phase 2: OpenAPI/Coverage (2 min)
- Phase 3: Test Coverage (1 min)
- Phase 4: Features (2 min)
- Phase 5: Sign-off (1 min)
- **Buffer**: 3 min (questions, delays)

---

### 4. Git Tag Artifact (Version Control Entity)

**Purpose**: Immutable marker in repository history indicating Week 5 work completion.

**Schema**:
```yaml
GitTag:
  name: "week5-complete"
  type: "annotated"              # Must be annotated, not lightweight
  message: string                # "Week 5 Complete: Final Polish, Review Packet & Demo Prep - Ready for Production"
  author: string                 # Git user who created tag
  timestamp: ISO8601
  pointsTo: GitCommit
    sha: string                  # Commit hash of final merge
    message: string              # PR merge commit message
    branch: "main"               # Tag must be on main branch
    
TagValidation:
  isAnnotated: boolean
  isOnMain: boolean
  isPushedToRemote: boolean
  isAccessibleViaGitHub: boolean # Visible in GitHub releases/tags page
```

**Key Fields**:
- **name**: Exact string `week5-complete`
- **type**: MUST be annotated (not lightweight)
- **message**: Clear, descriptive commit message
- **pointsTo**: Final merge commit on main

**Validation Rules**:
- Tag MUST be annotated (includes metadata)
- Tag MUST point to main branch commit
- Tag MUST be pushed to remote (accessible to cloners)
- Tag MUST be created after all PR merges complete

**State Transitions**:
- Created (local git tag) → Pushed (remote repository) → Discoverable (GitHub tag page)

---

### 5. GitHub Project Board State (Tracking Entity)

**Purpose**: Visual representation of Week 5 work completion; demonstrates project management rigor.

**Schema**:
```yaml
ProjectBoard:
  name: "Training Prince"
  boardColumns: Array<Column>
    - "To Do"
    - "In Progress"
    - "In Review"
    - "Done"
    
  week5Issues: Array<IssueCard>
    - title: string              # e.g., "Week 5 Day 0: Setup"
      issueNumber: integer       # GitHub issue #NNN
      status: Column             # Current column position
      labels: Array<string>      # ["week5", "day-0"] etc.
      
BoardCleanupCheckpoint:
  allDay0Issues: boolean         # All in "Done"
  allDay1Issues: boolean         # All in "Done"
  allDay2Issues: boolean         # All in "Done"
  allDay3Issues: boolean         # All in "Done"
  allDay4Issues: boolean         # All in "Done"
  totalIssuesInDone: integer    # Should be 5+ (one per day minimum)
  cleanupCompleted: boolean      # All Week 5 issues visible in Done
  cleanupTimestamp: ISO8601
```

**Key Fields**:
- **week5Issues**: List of all tracked Week 5 work items
- **status**: Current column position (target: "Done" for all)

**Validation Rules**:
- All Week 5 issues (Day 0-4) MUST be in "Done" column before demo
- No Week 5 issues in "To Do" or "In Progress"
- Zero outstanding items = demo readiness signal

---

## Relationships & Data Flow

```
CHANGELOG.md (file)
  ↓ (contains)
  CHANGELOG Entry (Week 5)
  
Review Packet Artifact (index.html)
  ├─ links to → Coverage Reports (CHANGELOG Entry references)
  ├─ links to → OpenAPI HTML (generated from spec)
  ├─ links to → Playwright Report (test results)
  └─ links to → CHANGELOG.md (Week 5 section)
  
Demo Script
  ├─ uses → Review Packet Artifact (walkthrough steps)
  ├─ references → Git Tag (proof of completion)
  ├─ displays → Project Board State (visual progress)
  └─ ends with → Mentor Sign-Off (GitHub comment)
  
Git Tag (week5-complete)
  ├─ points to → Final commit on main
  └─ marks → Moment all deliverables are merged & demo-ready
  
GitHub Project Board
  └─ shows → All Week 5 issues in "Done" (visual confirmation)
```

---

## Success Criteria (Data Model Perspective)

✅ **SC-DM-001**: CHANGELOG.md contains Week 5 section with entries for all 6 features (API Scaffolding, POST /expenses, GET /expenses/summary, Rate Limiter, Coverage Hardening, Security CI)

✅ **SC-DM-002**: Review Packet index.html loads and displays 4 clickable artifact links with descriptions

✅ **SC-DM-003**: All 4 artifact links (Coverage, OpenAPI, Playwright, CHANGELOG) return 200 OK and render without errors

✅ **SC-DM-004**: Demo script contains 5 phases with specific timing and fallback options

✅ **SC-DM-005**: Git tag `week5-complete` exists as annotated tag on main branch and is pushed to remote

✅ **SC-DM-006**: GitHub Project Board shows 100% of Week 5 issues (Day 0-4) in "Done" column

✅ **SC-DM-007**: Mentor approval comment on feature PR uses sign-off template and is recorded as GitHub comment

---

## Next Steps (Phase 1 Continuation)

1. Create contracts/ directory with JSON schemas for review-packet/index.html template
2. Create quickstart.md with demo script walkthrough and timing guide
3. Update agent context with phase 1 findings
4. Re-validate against constitution
